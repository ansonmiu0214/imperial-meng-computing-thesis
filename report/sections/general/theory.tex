\chapter{\newtheory: A Theory of
Routed Multiparty Session Types}
\label{chap:theory}

In this chapter, we present
\newtheory, an extension of the
canonical multiparty session type (MPST)
theory with a message routing mechanism.
We build upon the variant of MPST theory introduced
in \cite{LessIsMore}
(which we have also discussed in \cref{subsection:bgmpst}), 
and extend it
with constructs for communication actions
that are routed through a participant.
We introduce the extended syntax for types in 
\cref{section:syntax}, and give semantics of our
syntax extensions in \cref{section:lts}.

\newtheory provide the theoretical basis
for allowing developers to implement
protocols with browser-to-browser interactions
(such as the \tprotocol{Two Buyer} protocol
introduced in \cref{section:twobuyer})
over a server-centric network topology
which uses WebSocket transport.
We define a router-parameterised encoding
for MPST into \newtheory in \cref{section:encoding}
and prove the preservation of well-formedness
and communication.
We proceed to extend \codegen to implement \newtheory
in \cref{chap:impl}.

\input{sections/general/theory/syntax}

\input{sections/general/theory/lts}

\input{sections/general/theory/encoding}
